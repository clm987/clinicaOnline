<div class="turnos-wrapper">
    <div class="turnos-card">
        <h2 class="text-center mb-4">Mis Turnos</h2>

        <div class="mb-3">
            <label class="form-label">Especialidades</label>
            <div class="d-flex flex-wrap gap-2">
                <button *ngFor="let esp of especialidades()" class="btn btn-outline-primary btn-sm"
                    (click)="seleccionarEspecialidad(esp)">
                    {{ esp }}
                </button>
            </div>
        </div>

        <div *ngIf="especialidadSeleccionada" class="mb-3">
            <label class="form-label">Especialistas</label>
            <div class="d-flex flex-wrap gap-2">
                <button *ngFor="let est of especialistasFiltrados()" class="btn btn-outline-success btn-sm"
                    (click)="seleccionarEspecialista(est)">
                    {{ est.nombre }} {{ est.apellido }}
                </button>
            </div>
        </div>

        <div *ngIf="horariosDisponibles().length > 0" class="mb-3">
            <label class="form-label">Horarios disponibles</label>
            <div class="d-flex flex-wrap gap-2">
                <button *ngFor="let h of horariosDisponibles()" class="btn btn-outline-info btn-sm"
                    (click)="seleccionarHorario(h)">
                    {{ h.fecha | date: 'shortDate' }} - {{ h.horario }}
                </button>
            </div>
        </div>

        <div *ngIf="horarioSeleccionado" class="alert alert-warning mt-3">
            ¿Confirmás solicitar un turno con el especialista
            <strong>{{ nombreEspecialistaSeleccionado }}</strong> el
            <strong>{{ horarioSeleccionado.fecha | date: 'fullDate' }}</strong> a las
            <strong>{{ horarioSeleccionado.horario }}</strong>?
            <div class="mt-3 d-flex gap-2">
                <button class="btn btn-success btn-sm" (click)="confirmarTurno()">Confirmar</button>
                <button class="btn btn-secondary btn-sm" (click)="cancelarSeleccion()">Cancelar</button>
            </div>
        </div>

        <div class="mt-4">
            <div *ngFor="let turno of turnos()" class="card mb-3">
                <div class="card-body">
                    <h5 class="card-title">{{ turno.especialidad }}</h5>
                    <p class="card-text">
                        <strong>Especialista:</strong> {{ turno.nombre_especialista }}<br />
                        <strong>Fecha:</strong> {{ turno.fecha_turno | date: 'fullDate' }}<br />
                        <strong>Hora:</strong> {{ turno.hora_turno }}
                    </p>
                    <span class="badge bg-info text-dark">{{ turno.estado }}</span>

                    <div class="mt-3" *ngIf="turno.estado === 'solicitado'">
                        <input type="text" class="form-control mb-2" [(ngModel)]="turno.motivo_cancelacion"
                            placeholder="Motivo de cancelación">
                        <button class="btn btn-danger btn-sm" (click)="cancelarTurno(turno)">Cancelar turno</button>
                    </div>

                    <div class="mt-3" *ngIf="turno.estado === 'realizado' && !turno.calificacion_paciente">
                        <input type="text" class="form-control mb-2" [(ngModel)]="turno.comentario_paciente"
                            placeholder="Tu comentario sobre la atención">
                        <button class="btn btn-primary btn-sm" (click)="calificarTurno(turno)">Calificar
                            atención</button>
                    </div>

                    <div class="mt-3 d-flex gap-2"
                        *ngIf="turno.estado === 'realizado' && turno.comentario_especialista">
                        <button class="btn btn-info btn-sm" (click)="verResena(turno)">Ver reseña</button>
                        <button class="btn btn-secondary btn-sm" (click)="completarEncuesta(turno)">Completar
                            encuesta</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
import{A as Te,Aa as L,B as y,Ba as U,C as o,Ca as ie,D as n,Da as ne,E as g,Ea as oe,F as h,Fa as we,G as p,Ga as Y,H as l,Ha as ae,Ia as re,Ja as se,Ka as J,M as r,N as v,O as S,P as I,Q as z,R as A,S as N,V as T,X as w,aa as V,ba as O,ca as B,d as X,ea as ee,f as E,g as u,h as _,i as ve,k as Ce,l as x,ma as fe,na as D,o as k,oa as H,p as s,qa as q,r as Se,s as _e,sa as C,t as F,ta as j,u as Z,ua as W,v as Ee,wa as te,x as f,xa as G,y as $,z as m}from"./chunk-Q6QX7URF.js";import"./chunk-X5YLR3NI.js";import{a as M,b as P,i as b}from"./chunk-ODN5LVDJ.js";var R=class i{constructor(t,e){this.el=t;this.rd=e}brWidth=100;brHeight=40;display="inline-block";get w(){return this.brWidth}get h(){return this.brHeight}borderRadius="8px";border="none";padding="0.5rem 1rem";bg="#f0f0f0";boxShadow="0 2px 6px rgba(0, 0, 0, 0.15)";transition="transform 0.15s ease, box-shadow 0.15s ease";cursor="pointer";textAlign="center";fontWeight="500";ngAfterViewInit(){this.rd.listen(this.el.nativeElement,"mouseenter",()=>{this.rd.setStyle(this.el.nativeElement,"transform","translateY(-2px)"),this.rd.setStyle(this.el.nativeElement,"boxShadow","0 4px 8px rgba(0,0,0,0.2)")}),this.rd.listen(this.el.nativeElement,"mouseleave",()=>{this.rd.setStyle(this.el.nativeElement,"transform","translateY(0)"),this.rd.setStyle(this.el.nativeElement,"boxShadow","0 2px 6px rgba(0, 0, 0, 0.15)")})}static \u0275fac=function(e){return new(e||i)(_e(Ce),_e(Se))};static \u0275dir=Ee({type:i,selectors:[["","botonesRectangulares",""]],hostVars:24,hostBindings:function(e,a){e&2&&Te("display",a.display)("width",a.w,"px")("height",a.h,"px")("border-radius",a.borderRadius)("border",a.border)("padding",a.padding)("background-color",a.bg)("box-shadow",a.boxShadow)("transition",a.transition)("cursor",a.cursor)("text-align",a.textAlign)("font-weight",a.fontWeight)},inputs:{brWidth:"brWidth",brHeight:"brHeight"}})};function ke(i,t){if(i&1&&g(0,"app-mensaje",16),i&2){let e=t.ngIf;m("tipo",e.tipo)("mensaje",e.texto)}}function Fe(i,t){if(i&1){let e=h();o(0,"button",17),p("click",function(){let c=u(e).$implicit,d=l();return _(d.seleccionarEspecialidad(c.nombre))}),g(1,"img",18),n()}if(i&2){let e=t.$implicit;$("aria-label",e.nombre),s(),m("src",e.imagen_url||"/assets/img/placeholder-esp.png",k)("alt",e.nombre)}}function Ie(i,t){if(i&1){let e=h();o(0,"div",22)(1,"button",23),p("click",function(){let c=u(e).$implicit,d=l(2);return _(d.seleccionarEspecialista(c))}),g(2,"img",18),n(),o(3,"small",24),r(4),n()()}if(i&2){let e=t.$implicit;s(),$("aria-label",`${e.nombre} ${e.apellido}`),s(),m("src",e.avatar_url||"/assets/img/placeholder-user.png",k)("alt",`${e.nombre} ${e.apellido}`),s(2),I(" ",e.nombre," ",e.apellido," ")}}function Ve(i,t){if(i&1&&(o(0,"div",12)(1,"label",19),r(2,"Especialistas"),n(),o(3,"div",20),f(4,Ie,5,5,"div",21),n()()),i&2){let e=l();s(4),m("ngForOf",e.especialistasFiltrados())}}function Oe(i,t){i&1&&(o(0,"div",25),g(1,"div",26),o(2,"div",27),r(3,"Cargando..."),n()())}function De(i,t){if(i&1){let e=h();o(0,"button",30),T(1,"date"),p("click",function(){let c=u(e).$implicit,d=l(2);return _(d.seleccionarFecha(c))}),r(2),T(3,"date"),n()}if(i&2){let e=t.$implicit,a=l(2);y("active",e===a.fechaSeleccionada),$("aria-label","Fecha "+w(1,4,e,"fullDate")),s(2),S(" ",w(3,7,e,"dd/MM")," ")}}function je(i,t){if(i&1&&(o(0,"div",12)(1,"label",19),r(2,"Fechas disponibles"),n(),o(3,"div",28),f(4,De,4,10,"button",29),n()()),i&2){let e=l();s(4),m("ngForOf",e.fechasDisponibles())}}function Re(i,t){if(i&1){let e=h();o(0,"button",32),p("click",function(){let c=u(e).$implicit,d=l(2);return _(d.seleccionarHorario({horario:c,fecha:d.fechaSeleccionada}))}),r(1),n()}if(i&2){let e=t.$implicit,a=l(2);s(),S(" ",a.formatearHora(e)," ")}}function ze(i,t){if(i&1&&(o(0,"div",12)(1,"label",19),r(2,"Horarios disponibles"),n(),o(3,"div",28),f(4,Re,2,1,"button",31),n()()),i&2){let e=l();s(4),m("ngForOf",e.horasParaFecha())}}function Ae(i,t){if(i&1){let e=h();o(0,"div",33),r(1," \xBFConfirm\xE1s solicitar un turno con el especialista "),o(2,"strong"),r(3),n(),r(4," el "),o(5,"strong"),r(6),T(7,"date"),n(),r(8," a las "),o(9,"strong"),r(10),n(),r(11,"? "),o(12,"div",34)(13,"button",35),p("click",function(){u(e);let c=l();return _(c.confirmarTurno())}),r(14,"Confirmar"),n(),o(15,"button",36),p("click",function(){u(e);let c=l();return _(c.cancelarSeleccion())}),r(16,"Cancelar"),n()()()}if(i&2){let e=l();s(3),v(e.nombreEspecialistaSeleccionado),s(3),v(w(7,3,e.horarioSeleccionado.fecha,"fullDate")),s(4),v(e.horarioSeleccionado.horario)}}function Ne(i,t){if(i&1){let e=h();o(0,"div",43)(1,"input",44),N("ngModelChange",function(c){u(e);let d=l().$implicit;return A(d.motivo_cancelacion,c)||(d.motivo_cancelacion=c),_(c)}),n(),o(2,"button",45),p("click",function(){u(e);let c=l().$implicit,d=l();return _(d.cancelarTurno(c))}),r(3,"Cancelar turno"),n()()}if(i&2){let e=l().$implicit;s(),z("ngModel",e.motivo_cancelacion)}}function $e(i,t){if(i&1){let e=h();o(0,"div",43)(1,"input",46),N("ngModelChange",function(c){u(e);let d=l().$implicit;return A(d.comentario_paciente,c)||(d.comentario_paciente=c),_(c)}),n(),o(2,"button",47),p("click",function(){u(e);let c=l().$implicit,d=l();return _(d.calificarTurno(c))}),r(3,"Calificar atenci\xF3n"),n()()}if(i&2){let e=l().$implicit;s(),z("ngModel",e.comentario_paciente)}}function Be(i,t){if(i&1){let e=h();o(0,"button",51),p("click",function(){u(e);let c=l(2).$implicit,d=l();return _(d.abrirEncuesta(c))}),r(1,"Completar encuesta"),n()}}function He(i,t){i&1&&(o(0,"span",52),r(1,"Encuesta completada"),n())}function qe(i,t){if(i&1){let e=h();o(0,"div",43)(1,"button",48),p("click",function(){u(e);let c=l().$implicit,d=l();return _(d.verResena(c))}),r(2,"Ver rese\xF1a"),n(),f(3,Be,2,0,"button",49)(4,He,2,0,"span",50),n()}if(i&2){let e=l().$implicit;s(3),m("ngIf",!e.completadaEncuesta),s(),m("ngIf",e.completadaEncuesta)}}function We(i,t){if(i&1&&(o(0,"div",37)(1,"div",38)(2,"h5",39),r(3),n(),o(4,"p",40)(5,"strong"),r(6,"Especialista:"),n(),r(7),g(8,"br"),o(9,"strong"),r(10,"Fecha:"),n(),r(11),T(12,"date"),g(13,"br"),o(14,"strong"),r(15,"Hora:"),n(),r(16),n(),o(17,"span",41),r(18),n(),f(19,Ne,4,1,"div",42)(20,$e,4,1,"div",42)(21,qe,5,2,"div",42),n()()),i&2){let e=t.$implicit;s(3),v(e.especialidad),s(4),S(" ",e.nombre_especialista,""),s(4),S(" ",w(12,8,e.fecha_turno,"fullDate"),""),s(5),S(" ",e.hora_turno," "),s(2),v(e.estado),s(),m("ngIf",e.estado==="solicitado"),s(),m("ngIf",e.estado==="realizado"&&!e.calificacion_paciente),s(),m("ngIf",e.estado==="realizado"&&e.comentario_especialista)}}function Ge(i,t){if(i&1&&(o(0,"option",66),r(1),n()),i&2){let e=t.$implicit;m("value",e),s(),v(e)}}function Le(i,t){if(i&1&&(o(0,"option",66),r(1),n()),i&2){let e=t.$implicit;m("value",e),s(),v(e)}}function Ue(i,t){if(i&1&&(o(0,"option",66),r(1),n()),i&2){let e=t.$implicit;m("value",e),s(),v(e)}}function Ye(i,t){i&1&&(o(0,"div",67),g(1,"div",68),r(2," Guardando\u2026 "),n())}function Je(i,t){if(i&1&&(o(0,"small",69),r(1),n()),i&2){let e=l(2);s(),v(e.mensajeEncuesta)}}function Ke(i,t){if(i&1){let e=h();o(0,"div",53)(1,"div",54)(2,"h5",12),r(3,"Encuesta de satisfacci\xF3n"),n(),o(4,"form",55)(5,"label",19),r(6,"\xBFC\xF3mo valora la atenci\xF3n del especialista?"),n(),o(7,"select",56)(8,"option",57),r(9,"Seleccione\u2026"),n(),f(10,Ge,2,2,"option",58),n(),o(11,"label",19),r(12,"\xBFC\xF3mo valora la atenci\xF3n del personal administrativo?"),n(),o(13,"select",59)(14,"option",57),r(15,"Seleccione\u2026"),n(),f(16,Le,2,2,"option",58),n(),o(17,"label",19),r(18,"\xBFRecomendar\xEDa nuestros servicios?"),n(),o(19,"select",60)(20,"option",57),r(21,"Seleccione\u2026"),n(),f(22,Ue,2,2,"option",58),n()(),f(23,Ye,3,0,"div",61)(24,Je,2,1,"small",62),o(25,"div",63)(26,"button",64),p("click",function(){u(e);let c=l();return _(c.enviarEncuesta())}),r(27,"Enviar"),n(),o(28,"button",65),p("click",function(){u(e);let c=l();return _(c.cancelarEncuesta())}),r(29,"Cancelar"),n()()()()}if(i&2){let e=l();s(4),m("formGroup",e.encuestaForm),s(6),m("ngForOf",e.opciones12),s(6),m("ngForOf",e.opciones12),s(6),m("ngForOf",e.opciones3),s(),m("ngIf",e.cargandoEncuesta),s(),m("ngIf",e.mensajeEncuesta),s(2),m("disabled",e.encuestaForm.invalid||e.cargandoEncuesta),s(2),m("disabled",e.cargandoEncuesta)}}var ce=class i{dbService=E(D);credencialesService=E(H);fb=E(Y);turnos=x([]);especialidades=x([]);especialistasFiltrados=x([]);fechasDisponibles=x([]);horariosDisponibles=x([]);horariosPorDia=x([]);mensaje=x(null);especialistaSeleccionado=null;nombreEspecialistaSeleccionado="";especialidadSeleccionada=null;horarioSeleccionado=null;fechaSeleccionada=null;loadingFechas=!1;encuestaModalVisible=x(!1);encuestaForm;turnoEncuesta=null;cargandoEncuesta=!1;mensajeEncuesta="";opciones12=["Muy buena","Buena","Mala","Muy mala"];opciones3=["S\xED","Puede ser","No"];usuarioActual=null;diasES=["domingo","lunes","martes","mi\xE9rcoles","jueves","viernes","s\xE1bado"];ngOnInit(){return b(this,null,function*(){this.usuarioActual=yield this.credencialesService.getUsuarioActualAsync(),this.usuarioActual&&(yield this.actualizarTurnos());let t=yield this.dbService.obtenerEspecialidadesConImagen();this.especialidades.set(t.slice(0,10)),this.encuestaForm=this.fb.group({r1:["",C.required],r2:["",C.required],r3:["",C.required]})})}seleccionarEspecialidad(t){this.especialidadSeleccionada=t,this.resetHorarios(),this.filtrarEspecialistas()}seleccionarEspecialista(t){return b(this,null,function*(){this.especialistaSeleccionado=t,this.nombreEspecialistaSeleccionado=`${t.nombre} ${t.apellido}`,this.resetHorarios(),this.loadingFechas=!0;let e=yield this.dbService.obtenerFechasDisponibles(t.user_auth_id,14);if(this.loadingFechas=!1,!e.length){this.mensaje.set({texto:"El especialista no tiene horarios disponibles en los pr\xF3ximos 15 d\xEDas.",tipo:"warning"});return}this.fechasDisponibles.set(e)})}seleccionarFecha(t){return b(this,null,function*(){this.fechaSeleccionada=t;let e=yield this.dbService.obtenerHorariosDisponibles(this.especialistaSeleccionado.user_auth_id,t);this.horariosDisponibles.set(e||[])})}horasParaFecha(){let t=this.fechaSeleccionada;return this.horariosDisponibles().filter(e=>e.fecha===t).map(e=>e.horario)}seleccionarHorario(t){this.horarioSeleccionado=t}confirmarTurno(){return b(this,null,function*(){if(!this.usuarioActual||!this.especialistaSeleccionado||!this.horarioSeleccionado)return;let t=`${this.horarioSeleccionado.fecha}T${this.horarioSeleccionado.horario}`,e={paciente_id:this.usuarioActual.id,especialista_id:this.especialistaSeleccionado.user_auth_id,especialidad:this.especialidadSeleccionada,fecha_hora:t,estado:"solicitado"};yield this.dbService.solicitarTurno(e),yield this.actualizarTurnos(),this.mensaje.set({texto:"Turno solicitado con \xE9xito.",tipo:"success"}),this.cancelarSeleccion()})}cancelarTurno(t){return b(this,null,function*(){if(!t.motivo_cancelacion?.trim()){this.mensaje.set({texto:"Por favor, ingrese un motivo para cancelar el turno.",tipo:"error"});return}yield this.dbService.cancelarTurno(t.id,t.motivo_cancelacion),yield this.actualizarTurnos(),this.mensaje.set({texto:"El turno fue cancelado correctamente.",tipo:"success"})})}calificarTurno(t){return b(this,null,function*(){if(!t.comentario_paciente?.trim()){this.resetMensaje(),this.mensaje.set({texto:"Por favor, ingrese un comentario para calificar la atenci\xF3n.",tipo:"error"});return}yield this.dbService.guardarCalificacion(t.id,t.comentario_paciente),yield this.actualizarTurnos(),this.resetMensaje(),this.mensaje.set({texto:"Gracias por calificar la atenci\xF3n.",tipo:"success"})})}resetMensaje(){this.mensaje.set(null)}verResena(t){this.mensaje.set(null),setTimeout(()=>{this.mensaje.set({texto:`Rese\xF1a del especialista:

${t.comentario_especialista}`,tipo:"info"})})}abrirEncuesta(t){this.turnoEncuesta=t,this.encuestaForm.reset(),this.mensajeEncuesta="",this.encuestaModalVisible.set(!0)}cancelarEncuesta(){this.encuestaModalVisible.set(!1)}enviarEncuesta(){return b(this,null,function*(){if(this.turnoEncuesta&&!this.encuestaForm.invalid){this.cargandoEncuesta=!0,this.mensajeEncuesta="";try{yield this.dbService.crearEncuesta({turno_id:this.turnoEncuesta.id,respuesta1:this.encuestaForm.value.r1,respuesta2:this.encuestaForm.value.r2,respuesta3:this.encuestaForm.value.r3}),this.turnoEncuesta.completadaEncuesta=!0,this.mensajeEncuesta="Encuesta enviada \u2714",this.encuestaModalVisible.set(!1)}catch{this.mensajeEncuesta="Error al guardar la encuesta."}finally{this.cargandoEncuesta=!1}}})}actualizarTurnos(){return b(this,null,function*(){if(!this.usuarioActual)return;let e=(yield this.dbService.obtenerTurnosPorUsuario(this.usuarioActual.id,"paciente")).map(a=>P(M({},a),{fecha_turno:new Date(a.fecha_hora),hora_turno:new Date(a.fecha_hora).toTimeString().substring(0,5),completadaEncuesta:!!a.encuesta_id}));this.turnos.set(e)})}filtrarEspecialistas(){return b(this,null,function*(){if(!this.especialidadSeleccionada)return;let t=yield this.dbService.obtenerEspecialistasPorEspecialidad(this.especialidadSeleccionada);this.especialistasFiltrados.set(t)})}cancelarSeleccion(){this.resetHorarios(),this.especialidadSeleccionada=null,this.especialistaSeleccionado=null,this.nombreEspecialistaSeleccionado=""}resetHorarios(){this.horariosDisponibles.set([]),this.fechasDisponibles.set([]),this.horariosPorDia.set([]),this.horarioSeleccionado=null}formatearHora(t){let[e,a]=t.split(":"),c=+e,d=c>=12?"pm":"am";return c=c%12,c===0&&(c=12),`${c.toString().padStart(2,"0")}:${a} ${d}`}cerrarSesion(){return b(this,null,function*(){yield this.credencialesService.logout(),window.location.href="/home"})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=F({type:i,selectors:[["app-mis-turnos-paciente"]],standalone:!1,decls:22,vars:9,consts:[[1,"turnos-wrapper"],[1,"btn-salir",3,"click"],[1,"turnos-card"],[1,"text-center","mb-4"],[3,"tipo","mensaje",4,"ngIf"],[1,"panel-seleccion"],[1,"d-flex","flex-wrap","gap-3","mb-3"],["botonesRedondos","","class","especialidad-btn",3,"click",4,"ngFor","ngForOf"],["class","mb-3",4,"ngIf"],["class","spinner-wrapper text-center my-4",4,"ngIf"],["class","alert alert-warning mt-3",4,"ngIf"],[1,"panel-turnos"],[1,"mb-3"],[1,"turnos-grid"],["class","card turno-card",4,"ngFor","ngForOf"],["class","modal-backdrop",4,"ngIf"],[3,"tipo","mensaje"],["botonesRedondos","",1,"especialidad-btn",3,"click"],["loading","lazy",3,"src","alt"],[1,"form-label"],[1,"d-flex","flex-wrap","gap-3"],["class","especialista-card text-center",4,"ngFor","ngForOf"],[1,"especialista-card","text-center"],["botonesRedondos","",1,"especialista-btn",3,"click"],[1,"nombre-label","mt-1","d-block"],[1,"spinner-wrapper","text-center","my-4"],["role","status",1,"spinner-border","text-primary"],[1,"mt-2"],[1,"fechas-container"],["botonesRectangulares","","class","fecha-btn",3,"active","click",4,"ngFor","ngForOf"],["botonesRectangulares","",1,"fecha-btn",3,"click"],["botonesRectangulares","","class","hora-btn",3,"click",4,"ngFor","ngForOf"],["botonesRectangulares","",1,"hora-btn",3,"click"],[1,"alert","alert-warning","mt-3"],[1,"mt-3","d-flex","gap-2"],["botonesRectangulares","",1,"btn","btn-success","btn-sm",3,"click"],["botonesRectangulares","",1,"btn","btn-secondary","btn-sm",3,"click"],[1,"card","turno-card"],[1,"card-body"],[1,"card-title"],[1,"card-text"],[1,"badge","bg-info","text-dark"],["class","acciones-turno",4,"ngIf"],[1,"acciones-turno"],["placeholder","Motivo de cancelaci\xF3n",1,"form-control",3,"ngModelChange","ngModel"],["botonesRectangulares","",1,"btn","btn-danger","btn-sm","action-btn",3,"click"],["placeholder","Tu comentario sobre la atenci\xF3n",1,"form-control",3,"ngModelChange","ngModel"],["botonesRectangulares","",1,"btn","btn-primary","btn-sm","action-btn",3,"click"],["botonesRectangulares","",1,"btn","btn-info","btn-sm","action-btn",3,"click"],["class","btn btn-secondary btn-sm action-btn","botonesRectangulares","",3,"click",4,"ngIf"],["class","badge bg-success ms-2",4,"ngIf"],["botonesRectangulares","",1,"btn","btn-secondary","btn-sm","action-btn",3,"click"],[1,"badge","bg-success","ms-2"],[1,"modal-backdrop"],[1,"modal-card"],[3,"formGroup"],["formControlName","r1",1,"form-select","mb-3"],["value","","disabled",""],[3,"value",4,"ngFor","ngForOf"],["formControlName","r2",1,"form-select","mb-3"],["formControlName","r3",1,"form-select","mb-2"],["class","text-center my-2",4,"ngIf"],["class","text-success",4,"ngIf"],[1,"d-flex","gap-2","mt-3"],[1,"btn","btn-success",3,"click","disabled"],[1,"btn","btn-secondary",3,"click","disabled"],[3,"value"],[1,"text-center","my-2"],[1,"spinner-border","spinner-border-sm"],[1,"text-success"]],template:function(e,a){e&1&&(o(0,"div",0)(1,"button",1),p("click",function(){return a.cerrarSesion()}),r(2,"Salir"),n(),o(3,"div",2)(4,"h2",3),r(5,"Mis Turnos"),n(),f(6,ke,1,2,"app-mensaje",4),o(7,"section",5)(8,"div",6),f(9,Fe,2,3,"button",7),n(),f(10,Ve,5,1,"div",8)(11,Oe,4,0,"div",9)(12,je,5,1,"div",8)(13,ze,5,1,"div",8)(14,Ae,17,6,"div",10),n(),g(15,"br"),o(16,"section",11)(17,"h1",12),r(18,"Listado turnos"),n(),o(19,"div",13),f(20,We,22,11,"div",14),n()()()(),f(21,Ke,30,8,"div",15)),e&2&&(s(6),m("ngIf",a.mensaje()),s(3),m("ngForOf",a.especialidades()),s(),m("ngIf",a.especialidadSeleccionada),s(),m("ngIf",a.loadingFechas),s(),m("ngIf",a.fechasDisponibles().length),s(),m("ngIf",a.fechaSeleccionada&&a.horasParaFecha().length),s(),m("ngIf",a.horarioSeleccionado),s(6),m("ngForOf",a.turnos()),s(),m("ngIf",a.encuestaModalVisible()))},dependencies:[V,O,G,ne,oe,q,ie,j,W,te,L,U,se,J,R,B],styles:[".turnos-wrapper[_ngcontent-%COMP%]{background-image:url(/assets/img/fondoClinica.jpeg);background-size:cover;background-position:center;min-height:100vh;display:flex;justify-content:center;padding:2rem}.turnos-card[_ngcontent-%COMP%]{background-color:#ffffffe6;padding:2rem;border-radius:1rem;width:100%;max-width:900px;box-shadow:0 0 15px #0000004d;display:flex;flex-direction:column;gap:2rem}.panel-seleccion[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.panel-turnos[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}.fechas-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1rem}.fecha-btn[_ngcontent-%COMP%], .hora-btn[_ngcontent-%COMP%]{margin:0}.turnos-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:1.5rem}.turno-card[_ngcontent-%COMP%]{min-height:180px}.acciones-turno[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem;margin-top:1rem}.action-btn[_ngcontent-%COMP%]{margin:0}.especialidad-btn[_ngcontent-%COMP%]{background:none;border:0;padding:0;outline:0}.especialidad-btn[_ngcontent-%COMP%]:hover{transform:scale(1.06);transition:transform .2s ease}.especialista-btn[_ngcontent-%COMP%]{display:inline-block;padding:0;border:none;background:none;outline:none}.especialista-btn[_ngcontent-%COMP%]:hover{transform:scale(1.06)}.especialista-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;width:80px}.nombre-label[_ngcontent-%COMP%]{font-size:.75rem;text-align:center;line-height:1.1;margin-top:.25rem}button.active[_ngcontent-%COMP%]{background-color:#0d6efd!important;color:#fff}.spinner-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.btn-salir[_ngcontent-%COMP%]{position:absolute;top:1rem;right:1rem;background-color:#3546dc;color:#fff;padding:.4rem .9rem;border:none;border-radius:.5rem;font-size:.9rem;font-weight:700;z-index:10;transition:background-color .3s ease}.btn-salir[_ngcontent-%COMP%]:hover{background-color:#16067d}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:start;justify-content:center;padding-top:5vh;z-index:1050}.modal-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;width:100%;max-width:480px;padding:1.5rem;box-shadow:0 0 12px #0000004d}"]})};function Qe(i,t){if(i&1&&g(0,"app-mensaje",17),i&2){let e=t.ngIf;m("tipo",e.tipo)("mensaje",e.texto)}}function Xe(i,t){if(i&1){let e=h();o(0,"div",18)(1,"button",19),p("click",function(){let c=u(e).$implicit,d=l();return _(d.actualizarFiltroEspecialidad(c.nombre))}),g(2,"img",20),n(),o(3,"small",21),r(4),n()()}if(i&2){let e=t.$implicit,a=l();s(),y("active",a.filtro().filtroEspecialidad===e.nombre),$("aria-label",e.nombre),s(),m("src",e.imagen_url||"/assets/img/placeholder-esp.png",k)("alt",e.nombre),s(2),v(e.nombre)}}function Ze(i,t){if(i&1){let e=h();o(0,"div",28)(1,"input",34),p("input",function(c){u(e);let d=l().$implicit,ue=l();return _(ue.actualizarComentario(d.id,c.target.value))}),n()()}}function et(i,t){if(i&1){let e=h();o(0,"button",35),p("click",function(){u(e);let c=l().$implicit,d=l();return _(d.aceptarTurno(c))}),r(1,"Aceptar"),n()}}function tt(i,t){if(i&1){let e=h();o(0,"button",36),p("click",function(){u(e);let c=l().$implicit,d=l();return _(d.cancelarTurno(c))}),r(1,"Cancelar"),n()}}function it(i,t){if(i&1){let e=h();o(0,"button",37),p("click",function(){u(e);let c=l().$implicit,d=l();return _(d.rechazarTurno(c))}),r(1,"Rechazar"),n()}}function nt(i,t){if(i&1){let e=h();o(0,"button",38),p("click",function(){u(e);let c=l().$implicit,d=l();return _(d.mostrarModalFinalizar(c))}),r(1,"Finalizar"),n()}}function ot(i,t){if(i&1){let e=h();o(0,"button",39),p("click",function(){u(e);let c=l().$implicit,d=l();return _(d.verResena(c))}),r(1," Ver Rese\xF1a "),n()}}function at(i,t){if(i&1&&(o(0,"div",22)(1,"div",23)(2,"h5",24),r(3),n(),o(4,"p",25)(5,"strong"),r(6,"Paciente:"),n(),r(7),g(8,"br"),o(9,"strong"),r(10,"Fecha:"),n(),r(11),T(12,"date"),g(13,"br"),o(14,"strong"),r(15,"Hora:"),n(),r(16),n(),o(17,"span",26),r(18),n(),f(19,Ze,2,0,"div",27),o(20,"div",28),f(21,et,2,0,"button",29)(22,tt,2,0,"button",30)(23,it,2,0,"button",31)(24,nt,2,0,"button",32)(25,ot,2,0,"button",33),n()()()),i&2){let e=t.$implicit,a=l();s(3),v(e.especialidad),s(4),I(" ",e.nombre_paciente," ",e.apellido_paciente,""),s(4),S(" ",w(12,12,e.fecha_turno,"fullDate"),""),s(5),S(" ",e.hora_turno," "),s(2),v(e.estado),s(),m("ngIf",a.puedeCancelar(e)||a.puedeRechazar(e)||a.puedeFinalizar(e)),s(2),m("ngIf",a.puedeAceptar(e)),s(),m("ngIf",a.puedeCancelar(e)),s(),m("ngIf",a.puedeRechazar(e)),s(),m("ngIf",a.puedeFinalizar(e)),s(),m("ngIf",a.puedeVerResena(e))}}function rt(i,t){if(i&1){let e=h();o(0,"div",40)(1,"div",41)(2,"h5",13),r(3,"Historia Cl\xEDnica"),n(),o(4,"form",42)(5,"div",43)(6,"div",44),g(7,"input",45),n(),o(8,"div",44),g(9,"input",46),n(),o(10,"div",44),g(11,"input",47),n(),o(12,"div",44),g(13,"input",48),n(),o(14,"div",44),g(15,"input",49),n(),o(16,"div",44),g(17,"input",50),n(),o(18,"div",44),g(19,"input",51),n(),o(20,"div",44),g(21,"input",52),n(),o(22,"div",44),g(23,"input",53),n(),o(24,"div",44),g(25,"input",54),n()()(),o(26,"div",55)(27,"button",56),p("click",function(){u(e);let c=l();return _(c.guardarHistoria())}),r(28,"Guardar"),n(),o(29,"button",57),p("click",function(){u(e);let c=l();return _(c.cerrarModal())}),r(30,"Cancelar"),n()(),o(31,"small",58),r(32),n()()()}if(i&2){let e=l();s(4),m("formGroup",e.historiaForm),s(28),v(e.mensajeModal())}}var le=class i{db=E(D);auth=E(H);fb=E(Y);turnos=x([]);especialidades=x([]);filtro=x({filtroEspecialidad:"",filtroPaciente:""});comentario=x({});usuarioActual=null;modalVisible=x(!1);turnoSeleccionado=null;mensajeModal=x("");historiaForm;mensaje=x(null);ngOnInit(){return b(this,null,function*(){this.usuarioActual=yield this.auth.getUsuarioActualAsync(),this.historiaForm=this.fb.group({altura:["",C.required],peso:["",C.required],temperatura:["",C.required],presion:["",C.required],clave1:["",C.required],valor1:["",C.required],clave2:["",C.required],valor2:["",C.required],clave3:["",C.required],valor3:["",C.required]}),yield this.cargarDatos()})}cargarDatos(){return b(this,null,function*(){if(!this.usuarioActual||(yield this.auth.getPerfilActual())!=="especialista")return;let[t,e,a]=yield Promise.all([this.db.obtenerTurnosPorUsuario(this.usuarioActual.id,"especialista"),this.db.obtenerUsuarioActual(this.usuarioActual.id),this.db.obtenerEspecialidadesConImagen()]),c=t.map(Q=>P(M({},Q),{fecha_turno:new Date(Q.fecha_hora),hora_turno:new Date(Q.fecha_hora).toTimeString().substring(0,5)}));this.turnos.set(c);let d=e.especialidades||[],ue=a.filter(Q=>d.includes(Q.nombre));this.especialidades.set(ue)})}cumpleFiltro=t=>{let e=this.filtro(),a=!e.filtroEspecialidad||t.especialidad===e.filtroEspecialidad,c=!e.filtroPaciente||t.nombre_paciente.toLowerCase().includes(e.filtroPaciente.toLowerCase())||t.apellido_paciente.toLowerCase().includes(e.filtroPaciente.toLowerCase());return a&&c};puedeCancelar=t=>!["aceptado","realizado","rechazado","cancelado"].includes(t.estado);puedeRechazar=t=>!["aceptado","realizado","cancelado"].includes(t.estado);puedeAceptar=t=>!["realizado","cancelado","rechazado"].includes(t.estado);puedeFinalizar=t=>t.estado==="aceptado";puedeVerResena=t=>t.estado==="realizado"&&!!t.comentario_especialista;verResena(t){this.mensaje.set(null),setTimeout(()=>{this.mensaje.set({texto:`Rese\xF1a del especialista:

${t.comentario_especialista}`,tipo:"info"})})}cancelarTurno(t){return b(this,null,function*(){let e=this.comentario()[t.id];e&&(yield this.db.cancelarTurno(t.id,e),yield this.cargarDatos())})}rechazarTurno(t){return b(this,null,function*(){let e=this.comentario()[t.id];e&&(yield this.db.rechazarTurno(t.id,e),yield this.cargarDatos())})}aceptarTurno(t){return b(this,null,function*(){yield this.db.aceptarTurno(t.id),yield this.cargarDatos()})}mostrarModalFinalizar(t){this.turnoSeleccionado=t,this.modalVisible.set(!0),this.historiaForm.reset(),this.mensajeModal.set("")}cerrarModal(){this.modalVisible.set(!1),this.turnoSeleccionado=null}guardarHistoria(){return b(this,null,function*(){if(!this.turnoSeleccionado)return;if(this.historiaForm.invalid){this.mensajeModal.set("Complete todos los campos.");return}let t=this.historiaForm.value,e={[t.clave1]:t.valor1,[t.clave2]:t.valor2,[t.clave3]:t.valor3},a={paciente_id:this.turnoSeleccionado.paciente_id,altura:t.altura,peso:t.peso,temperatura:t.temperatura,presion:t.presion,datos_extra:e};try{yield this.db.guardarHistoriaClinica(a);let c=this.comentario()[this.turnoSeleccionado.id]||"";yield this.db.finalizarTurno(this.turnoSeleccionado.id,c),this.cerrarModal(),yield this.cargarDatos()}catch{this.mensajeModal.set("Error al guardar la historia cl\xEDnica.")}})}actualizarComentario(t,e){this.comentario.set(P(M({},this.comentario()),{[t]:e}))}actualizarFiltroEspecialidad(t){this.filtro.set(P(M({},this.filtro()),{filtroEspecialidad:t}))}actualizarFiltroPaciente(t){this.filtro.set(P(M({},this.filtro()),{filtroPaciente:t}))}cerrarSesion(){return b(this,null,function*(){yield this.auth.logout(),window.location.href="/home"})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=F({type:i,selectors:[["app-mis-turnos-especialista"]],standalone:!1,decls:23,vars:5,consts:[[1,"turnos-wrapper"],[1,"btn-salir",3,"click"],[1,"turnos-card"],[1,"text-center","mb-4"],[3,"tipo","mensaje",4,"ngIf"],[1,"panel-seleccion"],[1,"form-label"],[1,"especialidades-container"],["class","especialidad-card text-center",4,"ngFor","ngForOf"],["botonesRectangulares","",1,"limpiar-btn",3,"click"],[1,"form-label","mt-3"],["type","text","placeholder","Ingrese nombre o apellido",1,"form-control","buscar-input",3,"input","value"],[1,"panel-turnos"],[1,"mb-3"],[1,"turnos-grid"],["class","card turno-card",4,"ngFor","ngForOf"],["class","modal-backdrop",4,"ngIf"],[3,"tipo","mensaje"],[1,"especialidad-card","text-center"],["botonesRedondos","",1,"especialidad-btn",3,"click"],["loading","lazy",3,"src","alt"],[1,"nombre-label","mt-1","d-block"],[1,"card","turno-card"],[1,"card-body"],[1,"card-title"],[1,"card-text"],[1,"badge","bg-info","text-dark"],["class","acciones-turno",4,"ngIf"],[1,"acciones-turno"],["botonesRectangulares","","class","btn btn-success btn-sm action-btn",3,"click",4,"ngIf"],["botonesRectangulares","","class","btn btn-warning btn-sm action-btn",3,"click",4,"ngIf"],["botonesRectangulares","","class","btn btn-danger btn-sm action-btn",3,"click",4,"ngIf"],["botonesRectangulares","","class","btn btn-primary btn-sm action-btn",3,"click",4,"ngIf"],["botonesRectangulares","","class","btn btn-info btn-sm action-btn",3,"click",4,"ngIf"],["type","text","placeholder","Comentario...",1,"form-control","comentario-input",3,"input"],["botonesRectangulares","",1,"btn","btn-success","btn-sm","action-btn",3,"click"],["botonesRectangulares","",1,"btn","btn-warning","btn-sm","action-btn",3,"click"],["botonesRectangulares","",1,"btn","btn-danger","btn-sm","action-btn",3,"click"],["botonesRectangulares","",1,"btn","btn-primary","btn-sm","action-btn",3,"click"],["botonesRectangulares","",1,"btn","btn-info","btn-sm","action-btn",3,"click"],[1,"modal-backdrop"],[1,"modal-card"],[3,"formGroup"],[1,"row","g-2"],[1,"col-6"],["placeholder","Altura","formControlName","altura",1,"form-control"],["placeholder","Peso","formControlName","peso",1,"form-control"],["placeholder","Temperatura","formControlName","temperatura",1,"form-control"],["placeholder","Presi\xF3n","formControlName","presion",1,"form-control"],["placeholder","Clave 1","formControlName","clave1",1,"form-control"],["placeholder","Valor 1","formControlName","valor1",1,"form-control"],["placeholder","Clave 2","formControlName","clave2",1,"form-control"],["placeholder","Valor 2","formControlName","valor2",1,"form-control"],["placeholder","Clave 3","formControlName","clave3",1,"form-control"],["placeholder","Valor 3","formControlName","valor3",1,"form-control"],[1,"d-flex","gap-2","mt-3"],[1,"btn","btn-success",3,"click"],[1,"btn","btn-secondary",3,"click"],[1,"text-danger"]],template:function(e,a){e&1&&(o(0,"div",0)(1,"button",1),p("click",function(){return a.cerrarSesion()}),r(2,"Salir"),n(),o(3,"div",2)(4,"h2",3),r(5,"Mis Turnos"),n(),f(6,Qe,1,2,"app-mensaje",4),o(7,"section",5)(8,"label",6),r(9,"Filtrar por Especialidad"),n(),o(10,"div",7),f(11,Xe,5,6,"div",8),o(12,"button",9),p("click",function(){return a.actualizarFiltroEspecialidad("")}),r(13,"Limpiar"),n()(),o(14,"label",10),r(15,"Buscar Paciente (nombre o apellido)"),n(),o(16,"input",11),p("input",function(d){return a.actualizarFiltroPaciente(d.target.value)}),n()(),o(17,"section",12)(18,"h3",13),r(19,"Listado turnos"),n(),o(20,"div",14),f(21,at,26,15,"div",15),n()(),f(22,rt,33,2,"div",16),n()()),e&2&&(s(6),m("ngIf",a.mensaje()),s(5),m("ngForOf",a.especialidades()),s(5),m("value",a.filtro().filtroPaciente),s(5),m("ngForOf",a.turnos().filter(a.cumpleFiltro)),s(),m("ngIf",a.modalVisible()))},dependencies:[V,O,G,q,j,W,L,U,se,J,R,B],styles:[".turnos-wrapper[_ngcontent-%COMP%]{background-image:url(/assets/img/fondoClinica.jpeg);background-size:cover;background-position:center;min-height:100vh;display:flex;justify-content:center;padding:2rem}.turnos-card[_ngcontent-%COMP%]{background-color:#ffffffe6;padding:2rem;border-radius:1rem;width:100%;max-width:1100px;box-shadow:0 0 15px #0000004d}.panel-seleccion[_ngcontent-%COMP%]{margin-bottom:2rem}.especialidades-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;gap:1.5rem;align-items:flex-end}.especialidad-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;width:70px}.especialidad-btn[_ngcontent-%COMP%]{background:none;border:0;padding:0;outline:0;width:60px;height:60px}.especialidad-btn[_ngcontent-%COMP%]:hover{transform:scale(1.06);transition:transform .2s ease}.nombre-label[_ngcontent-%COMP%]{font-size:.75rem;text-align:center;line-height:1.1;margin-top:.25rem}.limpiar-btn[_ngcontent-%COMP%]{height:36px;align-self:flex-end;margin-left:1rem}.buscar-input[_ngcontent-%COMP%]{max-width:300px;margin-top:1rem}.panel-turnos[_ngcontent-%COMP%]{margin-top:3rem}.turnos-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:2rem}.turno-card[_ngcontent-%COMP%]{background:#fff;border-radius:.75rem;padding:1rem;box-shadow:0 2px 8px #0000001a}.card-title[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:700}.card-text[_ngcontent-%COMP%]{font-size:.95rem;line-height:1.4;margin-bottom:.5rem}.badge[_ngcontent-%COMP%]{font-size:.85rem;padding:.4em .6em;margin-top:.5rem}.acciones-turno[_ngcontent-%COMP%]{margin-top:1rem;display:flex;flex-direction:column;gap:.5rem}.comentario-input[_ngcontent-%COMP%]{width:100%}.action-btn[_ngcontent-%COMP%]{min-width:110px}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0009;display:flex;justify-content:center;align-items:center;z-index:1050}.modal-card[_ngcontent-%COMP%]{background:#fff;border-radius:8px;padding:1.5rem;width:100%;max-width:500px;box-shadow:0 5px 20px #0000004d}.btn-salir[_ngcontent-%COMP%]{position:absolute;top:1rem;right:1rem;background-color:#3546dc;color:#fff;padding:.4rem .9rem;border:none;border-radius:.5rem;font-size:.9rem;font-weight:700;z-index:10;transition:background-color .3s ease}.btn-salir[_ngcontent-%COMP%]:hover{background-color:#16067d}"]})};function st(i,t){if(i&1){let e=h();o(0,"button",14),p("click",function(){let c=u(e).$implicit,d=l();return _(d.seleccionarPaciente(c))}),g(1,"img",15),n()}if(i&2){let e=t.$implicit,a=l();y("active",e===a.pacienteSeleccionado),s(),m("src",e.avatar_url||"/assets/img/placeholder-user.png",k)}}function ct(i,t){if(i&1){let e=h();o(0,"button",14),p("click",function(){let c=u(e).$implicit,d=l(2);return _(d.seleccionarEspecialidad(c.nombre))}),g(1,"img",16),n()}if(i&2){let e=t.$implicit,a=l(2);y("active",e.nombre===a.especialidadSeleccionada),s(),m("src",e.imagen_url||"/assets/img/placeholder-esp.png",k)}}function lt(i,t){if(i&1&&(o(0,"div",4)(1,"label",5),r(2,"Especialidades"),n(),o(3,"div",6),f(4,ct,2,3,"button",7),n()()),i&2){let e=l();s(4),m("ngForOf",e.especialidades())}}function dt(i,t){if(i&1){let e=h();o(0,"button",14),p("click",function(){let c=u(e).$implicit,d=l(2);return _(d.seleccionarEspecialista(c))}),g(1,"img",17),n()}if(i&2){let e=t.$implicit,a=l(2);y("active",e===a.especialistaSeleccionado),s(),m("src",e.avatar_url||"/assets/img/placeholder-user.png",k)}}function mt(i,t){if(i&1&&(o(0,"div",4)(1,"label",5),r(2,"Especialistas"),n(),o(3,"div",6),f(4,dt,2,3,"button",7),n()()),i&2){let e=l();s(4),m("ngForOf",e.especialistasFiltrados())}}function pt(i,t){if(i&1){let e=h();o(0,"button",19),p("click",function(){let c=u(e).$implicit,d=l(2);return _(d.seleccionarFecha(c))}),r(1),T(2,"date"),n()}if(i&2){let e=t.$implicit,a=l(2);y("active",e===a.fechaSeleccionada),s(),S(" ",w(2,3,e,"dd/MM")," ")}}function ut(i,t){if(i&1&&(o(0,"div",4)(1,"label",5),r(2,"Fechas"),n(),o(3,"div",6),f(4,pt,3,6,"button",18),n()()),i&2){let e=l();s(4),m("ngForOf",e.fechasUnicas)}}function _t(i,t){if(i&1){let e=h();o(0,"button",19),p("click",function(){let c=u(e).$implicit,d=l(2);return _(d.seleccionarHorario(c))}),r(1),n()}if(i&2){let e=t.$implicit,a=l(2);y("active",e===a.horarioSeleccionado),s(),S(" ",e.horario," ")}}function ft(i,t){if(i&1&&(o(0,"div",4)(1,"label",5),r(2,"Horas"),n(),o(3,"div",6),f(4,_t,2,3,"button",18),n()()),i&2){let e=l();s(4),m("ngForOf",e.horasFiltradas)}}function gt(i,t){if(i&1){let e=h();o(0,"div",20)(1,"p")(2,"strong"),r(3,"Paciente:"),n(),r(4),n(),o(5,"p")(6,"strong"),r(7,"Especialista:"),n(),r(8),n(),o(9,"p")(10,"strong"),r(11,"Fecha y hora:"),n(),r(12),T(13,"date"),n(),o(14,"div",21)(15,"button",22),p("click",function(){u(e);let c=l();return _(c.confirmarTurno())}),r(16,"Confirmar turno"),n(),o(17,"button",23),p("click",function(){u(e);let c=l();return _(c.cancelarSeleccion())}),r(18,"Cancelar"),n()()()}if(i&2){let e=l();s(4),I(" ",e.pacienteSeleccionado==null?null:e.pacienteSeleccionado.nombre," ",e.pacienteSeleccionado==null?null:e.pacienteSeleccionado.apellido," "),s(4),I(" ",e.especialistaSeleccionado==null?null:e.especialistaSeleccionado.nombre," ",e.especialistaSeleccionado==null?null:e.especialistaSeleccionado.apellido,""),s(4),I(" ",w(13,6,e.horarioSeleccionado.fecha,"fullDate")," - ",e.horarioSeleccionado.horario,"")}}function bt(i,t){if(i&1){let e=h();o(0,"div",30)(1,"div",31)(2,"input",32),N("ngModelChange",function(c){u(e);let d=l().$implicit;return A(d.motivo_cancelacion,c)||(d.motivo_cancelacion=c),_(c)}),n(),o(3,"button",19),p("click",function(){u(e);let c=l().$implicit,d=l();return _(d.cancelarTurno(c))}),r(4,"Cancelar"),n()(),o(5,"div",31)(6,"input",33),N("ngModelChange",function(c){u(e);let d=l().$implicit;return A(d.motivo_rechazo,c)||(d.motivo_rechazo=c),_(c)}),n(),o(7,"div",34)(8,"button",19),p("click",function(){u(e);let c=l().$implicit,d=l();return _(d.rechazarTurno(c))}),r(9,"Rechazar"),n(),o(10,"button",19),p("click",function(){u(e);let c=l().$implicit,d=l();return _(d.aceptarTurno(c))}),r(11,"Aceptar"),n()()()()}if(i&2){let e=l().$implicit;s(2),z("ngModel",e.motivo_cancelacion),s(4),z("ngModel",e.motivo_rechazo)}}function ht(i,t){if(i&1){let e=h();o(0,"div",30)(1,"input",35),N("ngModelChange",function(c){u(e);let d=l().$implicit;return A(d.comentario_especialista,c)||(d.comentario_especialista=c),_(c)}),n(),o(2,"button",19),p("click",function(){u(e);let c=l().$implicit,d=l();return _(d.finalizarTurno(c))}),r(3,"Finalizar"),n()()}if(i&2){let e=l().$implicit;s(),z("ngModel",e.comentario_especialista)}}function xt(i,t){if(i&1&&(o(0,"div",24)(1,"div",25)(2,"h5",26),r(3),n(),o(4,"p",27)(5,"strong"),r(6,"Paciente:"),n(),r(7),g(8,"br"),o(9,"strong"),r(10,"Especialista:"),n(),r(11),g(12,"br"),o(13,"strong"),r(14,"Fecha:"),n(),r(15),T(16,"date"),g(17,"br"),o(18,"strong"),r(19,"Hora:"),n(),r(20),n(),o(21,"span",28),r(22),n(),f(23,bt,12,2,"div",29)(24,ht,4,1,"div",29),n()()),i&2){let e=t.$implicit;s(3),v(e.especialidad),s(4),S(" ",e.nombre_paciente,""),s(4),S(" ",e.nombre_especialista,""),s(4),S(" ",w(16,8,e.fecha_turno,"fullDate"),""),s(5),S(" ",e.hora_turno," "),s(2),v(e.estado),s(),m("ngIf",e.estado==="solicitado"),s(),m("ngIf",e.estado==="aceptado")}}var de=class i{db=E(D);auth=E(H);turnos=x([]);pacientes=x([]);especialidades=x([]);especialistasFiltrados=x([]);horariosDisponibles=x([]);mensaje=x(null);pacienteSeleccionado=null;especialidadSeleccionada=null;especialistaSeleccionado=null;horarioSeleccionado=null;fechaSeleccionada=null;get fechasUnicas(){let t=new Map;return this.horariosDisponibles().forEach(e=>t.set(e.fecha,!0)),Array.from(t.keys()).sort()}seleccionarFecha(t){this.fechaSeleccionada=t,this.horarioSeleccionado=null}seleccionarHorario(t){this.horarioSeleccionado=t}get horasFiltradas(){return this.fechaSeleccionada?this.horariosDisponibles().filter(t=>t.fecha===this.fechaSeleccionada):[]}ngOnInit(){return b(this,null,function*(){yield this.cargarDatos()})}cargarDatos(){return b(this,null,function*(){if(!(yield this.auth.getUsuarioActualAsync())||(yield this.auth.getPerfilActual())!=="admin")return;let[e,a,c]=yield Promise.all([this.db.obtenerTodosLosTurnos(),this.db.obtenerTodosLosUsuarios(),this.db.obtenerEspecialidadesConImagen()]);this.turnos.set(e.map(d=>P(M({},d),{fecha_turno:new Date(d.fecha_hora),hora_turno:new Date(d.fecha_hora).toTimeString().substring(0,5)}))),this.pacientes.set(a.filter(d=>d.perfil==="paciente")),this.especialidades.set(c)})}seleccionarPaciente(t){this.pacienteSeleccionado=t,this.resetSelecciones(!0),this.especialidades.set(this.especialidades().slice(0,10))}seleccionarEspecialidad(t){this.especialidadSeleccionada=t,this.resetSelecciones(),this.filtrarEspecialistas()}seleccionarEspecialista(t){return b(this,null,function*(){this.especialistaSeleccionado=t,this.horariosDisponibles.set([]);let e=new Date().toISOString().substring(0,10),a=yield this.db.obtenerHorariosDisponibles(t.user_auth_id,e);if(!a?.length){this.mensaje.set({texto:"No hay horarios disponibles hoy.",tipo:"warning"});return}this.mensaje.set(null),this.horariosDisponibles.set(a)})}confirmarTurno(){return b(this,null,function*(){if(!this.pacienteSeleccionado||!this.especialistaSeleccionado||!this.horarioSeleccionado)return;let t=`${this.horarioSeleccionado.fecha}T${this.horarioSeleccionado.horario}`;yield this.db.solicitarTurno({paciente_id:this.pacienteSeleccionado.user_auth_id,especialista_id:this.especialistaSeleccionado.user_auth_id,especialidad:this.especialidadSeleccionada,fecha_hora:t,estado:"solicitado"}),yield this.cargarDatos(),this.mensaje.set({texto:"Turno creado.",tipo:"success"}),this.cancelarSeleccion()})}cancelarSeleccion(){this.resetSelecciones()}resetSelecciones(t=!1){t||(this.pacienteSeleccionado=this.pacienteSeleccionado),this.especialistaSeleccionado=null,this.horariosDisponibles.set([]),this.horarioSeleccionado=null}cancelarTurno(t){return b(this,null,function*(){if(!t.motivo_cancelacion){this.mensaje.set({texto:"Ingrese motivo.",tipo:"error"});return}yield this.db.cancelarTurno(t.id,t.motivo_cancelacion),yield this.cargarDatos()})}aceptarTurno(t){return b(this,null,function*(){yield this.db.aceptarTurno(t.id),yield this.cargarDatos()})}rechazarTurno(t){return b(this,null,function*(){if(!t.motivo_rechazo){this.mensaje.set({texto:"Ingrese motivo.",tipo:"error"});return}yield this.db.rechazarTurno(t.id,t.motivo_rechazo),yield this.cargarDatos()})}finalizarTurno(t){return b(this,null,function*(){if(!t.comentario_especialista){this.mensaje.set({texto:"Ingrese comentario.",tipo:"error"});return}yield this.db.finalizarTurno(t.id,t.comentario_especialista),yield this.cargarDatos()})}filtrarEspecialistas(){return b(this,null,function*(){let t=yield this.db.obtenerTodosLosUsuarios();this.especialistasFiltrados.set(t.filter(e=>e.perfil==="especialista"&&e.especialidades?.includes(this.especialidadSeleccionada)))})}cerrarSesion(){return b(this,null,function*(){yield this.auth.logout(),window.location.href="/home"})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=F({type:i,selectors:[["app-admin-turnos"]],standalone:!1,decls:20,vars:7,consts:[[1,"turnos-wrapper"],[1,"btn-salir",3,"click"],[1,"turnos-card"],[1,"panel-alta-turno"],[1,"bloque-seleccion"],[1,"form-label"],[1,"contenedor-botones"],["botonesRedondos","","class","btn-item",3,"active","click",4,"ngFor","ngForOf"],["class","bloque-seleccion",4,"ngIf"],["class","alert alert-info confirm-card",4,"ngIf"],[1,"panel-turnos-grid"],[1,"titulo-listado"],[1,"turnos-grid"],["class","card turno-card",4,"ngFor","ngForOf"],["botonesRedondos","",1,"btn-item",3,"click"],["alt","paciente",3,"src"],["alt","especialidad",3,"src"],["alt","especialista",3,"src"],["botonesRectangulares","","class","btn-rect",3,"active","click",4,"ngFor","ngForOf"],["botonesRectangulares","",1,"btn-rect",3,"click"],[1,"alert","alert-info","confirm-card"],[1,"botones-confirmacion"],["botonesRectangulares","",1,"btn-confirmar",3,"click"],["botonesRectangulares","",1,"btn-cancelar",3,"click"],[1,"card","turno-card"],[1,"card-body"],[1,"card-title"],[1,"card-text"],[1,"badge","bg-info","text-dark"],["class","acciones-turno",4,"ngIf"],[1,"acciones-turno"],[1,"campo-accion"],["placeholder","Motivo",1,"form-control",3,"ngModelChange","ngModel"],["placeholder","Motivo rechazo",1,"form-control",3,"ngModelChange","ngModel"],[1,"fila-botones"],["placeholder","Comentario",1,"form-control",3,"ngModelChange","ngModel"]],template:function(e,a){e&1&&(o(0,"div",0)(1,"button",1),p("click",function(){return a.cerrarSesion()}),r(2,"Salir"),n(),o(3,"div",2)(4,"section",3)(5,"div",4)(6,"label",5),r(7,"Pacientes"),n(),o(8,"div",6),f(9,st,2,3,"button",7),n()(),f(10,lt,5,1,"div",8)(11,mt,5,1,"div",8)(12,ut,5,1,"div",8)(13,ft,5,1,"div",8)(14,gt,19,9,"div",9),n(),o(15,"section",10)(16,"h3",11),r(17,"Listado de turnos"),n(),o(18,"div",12),f(19,xt,25,11,"div",13),n()()()()),e&2&&(s(9),m("ngForOf",a.pacientes()),s(),m("ngIf",a.pacienteSeleccionado),s(),m("ngIf",a.especialidadSeleccionada),s(),m("ngIf",a.horariosDisponibles().length&&a.especialistaSeleccionado),s(),m("ngIf",a.fechaSeleccionada),s(),m("ngIf",a.horarioSeleccionado),s(5),m("ngForOf",a.turnos()))},dependencies:[V,O,q,j,te,J,R,B],styles:[".turnos-wrapper[_ngcontent-%COMP%]{background-image:url(/assets/img/fondoClinica.jpeg);background-size:cover;background-position:center;min-height:100vh;display:flex;justify-content:center;padding:2rem}.turnos-card[_ngcontent-%COMP%]{background:#ffffffed;padding:2rem;border-radius:1rem;width:100%;max-width:900px;display:flex;flex-direction:column;gap:2rem;box-shadow:0 0 15px #0000004d}.btn-salir[_ngcontent-%COMP%]{position:absolute;top:1rem;right:1rem;background:#3546dc;color:#fff;border:none;border-radius:.5rem;font-size:.9rem;font-weight:700;padding:.45rem 1rem;transition:background .3s}.btn-salir[_ngcontent-%COMP%]:hover{background:#16067d}.panel-alta-turno[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.25rem}.bloque-seleccion[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{font-weight:600}.contenedor-botones[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.75rem}.btn-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:64px;height:64px;border-radius:50%;object-fit:cover}.btn-item.active[_ngcontent-%COMP%]{outline:3px solid #0d6efd}.btn-rect[_ngcontent-%COMP%]{min-width:90px;padding:.35rem .75rem}.btn-rect.active[_ngcontent-%COMP%]{background:#0d6efd;color:#fff}.confirm-card[_ngcontent-%COMP%]{border-radius:.75rem}.panel-turnos-grid[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:1rem}.titulo-listado[_ngcontent-%COMP%]{margin:0 0 .5rem;font-weight:700}.turnos-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;align-items:start}.turno-card[_ngcontent-%COMP%]{min-height:210px}.acciones-turno[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;margin-top:.75rem}.btn-confirmar[_ngcontent-%COMP%]{background:#28a745;color:#fff;border:none;padding:.4rem .9rem;border-radius:.5rem}.btn-cancelar[_ngcontent-%COMP%]{background:#6c757d;color:#fff;border:none;padding:.4rem .9rem;border-radius:.5rem}.btn-rect.active[_ngcontent-%COMP%]{background-color:#0d6efd;color:#fff}.btn-rect.active[_ngcontent-%COMP%]{background-color:#d0e3ff;color:#0a2f6b;font-weight:700}.btn-confirmar[_ngcontent-%COMP%], .btn-cancelar[_ngcontent-%COMP%]{color:#0a2f6b;font-weight:700}.btn-confirmar[_ngcontent-%COMP%]:hover, .btn-cancelar[_ngcontent-%COMP%]:hover{background-color:#d0e3ff;color:#0a2f6b}.botones-confirmacion[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-top:1rem;flex-wrap:wrap;justify-content:flex-start}.campo-accion[_ngcontent-%COMP%]{margin-bottom:1rem}.fila-botones[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-top:.5rem;flex-wrap:wrap}"]})};var vt=[{path:"paciente",component:ce},{path:"especialista",component:le},{path:"admin",component:de}],me=class i{static \u0275fac=function(e){return new(e||i)};static \u0275mod=Z({type:i});static \u0275inj=X({imports:[fe.forChild(vt),fe]})};function Ct(i,t){if(i&1&&(o(0,"option"),r(1),n()),i&2){let e=t.$implicit;s(),v(e)}}function St(i,t){if(i&1&&(o(0,"option"),r(1),n()),i&2){let e=t.$implicit;s(),v(e)}}function Et(i,t){if(i&1&&(o(0,"option"),r(1),n()),i&2){let e=t.$implicit;s(),v(e)}}function Tt(i,t){i&1&&(o(0,"div",19),g(1,"div",20),r(2," Guardando\u2026 "),n())}function wt(i,t){if(i&1&&(o(0,"div",21),r(1),n()),i&2){let e=l();s(),v(e.mensaje)}}var pe=class i{fb=E(Y);db=E(D);turnoId;cerrar=new ve;cargando=!1;mensaje="";form=this.fb.group({r1:["",C.required],r2:["",C.required],r3:["",C.required]});opciones12=["Muy buena","Buena","Mala","Muy mala"];opciones3=["S\xED","Puede ser","No"];enviar(){return b(this,null,function*(){if(!this.form.invalid){this.cargando=!0,this.mensaje="";try{yield this.db.crearEncuesta({turno_id:this.turnoId,respuesta1:this.form.value.r1,respuesta2:this.form.value.r2,respuesta3:this.form.value.r3}),this.mensaje="Encuesta enviada \u2714",this.cerrar.emit("enviada"),window.bootstrap.Modal.getInstance(document.getElementById("modalEncuesta")).hide()}catch{this.mensaje="Error al guardar la encuesta intente luego."}finally{this.cargando=!1}}})}cancelar(){this.cerrar.emit("cancelada")}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=F({type:i,selectors:[["app-encuesta"]],inputs:{turnoId:"turnoId"},outputs:{cerrar:"cerrar"},decls:34,vars:8,consts:[["id","modalEncuesta","tabindex","-1","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[3,"ngSubmit","formGroup"],[1,"modal-header"],[1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"form-label"],["formControlName","r1","required","",1,"form-select","mb-3"],["value","","disabled","","selected",""],[4,"ngFor","ngForOf"],["formControlName","r2","required","",1,"form-select","mb-3"],["formControlName","r3","required","",1,"form-select","mb-2"],["class","text-center my-2",4,"ngIf"],["class","text-success small",4,"ngIf"],[1,"modal-footer"],["type","submit",1,"btn","btn-primary",3,"disabled"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary",3,"click","disabled"],[1,"text-center","my-2"],[1,"spinner-border","spinner-border-sm"],[1,"text-success","small"]],template:function(e,a){e&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"form",3),p("ngSubmit",function(){return a.enviar()}),o(4,"div",4)(5,"h5",5),r(6,"Encuesta de satisfacci\xF3n"),n(),o(7,"button",6),p("click",function(){return a.cancelar()}),n()(),o(8,"div",7)(9,"label",8),r(10,"\xBFC\xF3mo valora la atenci\xF3n del especialista?"),n(),o(11,"select",9)(12,"option",10),r(13,"Seleccione\u2026"),n(),f(14,Ct,2,1,"option",11),n(),o(15,"label",8),r(16,"\xBFC\xF3mo valora la atenci\xF3n del personal administrativo?"),n(),o(17,"select",12)(18,"option",10),r(19,"Seleccione\u2026"),n(),f(20,St,2,1,"option",11),n(),o(21,"label",8),r(22,"\xBFRecomendar\xEDa nuestros servicios?"),n(),o(23,"select",13)(24,"option",10),r(25,"Seleccione\u2026"),n(),f(26,Et,2,1,"option",11),n(),f(27,Tt,3,0,"div",14)(28,wt,2,1,"div",15),n(),o(29,"div",16)(30,"button",17),r(31," Enviar "),n(),o(32,"button",18),p("click",function(){return a.cancelar()}),r(33," Cancelar "),n()()()()()()),e&2&&(s(3),m("formGroup",a.form),s(11),m("ngForOf",a.opciones12),s(6),m("ngForOf",a.opciones12),s(6),m("ngForOf",a.opciones3),s(),m("ngIf",a.cargando),s(),m("ngIf",a.mensaje),s(2),m("disabled",a.cargando||a.form.invalid),s(2),m("disabled",a.cargando))},dependencies:[ee,V,O,re,G,ne,oe,ie,j,W,we,L,U,ae],styles:[".modal-body[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600}"]})};var Me=class i{static \u0275fac=function(e){return new(e||i)};static \u0275mod=Z({type:i});static \u0275inj=X({imports:[ee,ae,re,me,pe]})};export{Me as TurnosModule};
